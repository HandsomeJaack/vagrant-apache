<VirtualHost *:80>
    RewriteEngine On
    RewriteCond %{REQUEST_SCHEME} ^http$
    RewriteRule ^(.*)$ https://%{SERVER_NAME}%{REQUEST_URI} [L,R]
</VirtualHost>

<VirtualHost _default_:443>
    ServerName www.dummy.com
    DocumentRoot /home/vagrant/flaskserver

    # Enable ssl for https redirection
    SSLEngine on
    SSLCertificateFile /home/vagrant/secrets/server.pem
    SSLCertificateKeyFile /home/vagrant/secrets/server.key

    # Enable flask server
    WSGIDaemonProcess dummyapp user=vagrant group=vagrant threads=5
    WSGIScriptAlias / /home/vagrant/flaskserver/dummyapp.wsgi
    <Directory /home/vagrant/flaskserver>
        WSGIProcessGroup dummyapp
        WSGIApplicationGroup %{GLOBAL}
        WSGIScriptReloading On

        Options FollowSymLinks
        Allow from all
        Require all granted
    </Directory>

    # To show static page
    <Directory /home/vagrant>
        Options FollowSymLinks
        Allow from all
        Require all granted
    </Directory>
    Alias /static/ /home/vagrant/html

    # Really helped with capturing flask errors
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
